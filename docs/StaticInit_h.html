<HTML>
<HEAD>
<TITLE>Source: StaticInit.h</TITLE>
<META NAME="Generator" CONTENT="KDOC ">
</HEAD>
<BODY bgcolor="#ffffff" text="#000000" link="#0000ff" vlink="#000099" alink= "#ffffff">
<TABLE WIDTH="100%" BORDER="0">
<TR>
<TD>
	<TABLE BORDER="0">
		<TR><TD valign="top" align="left" cellspacing="10">
		<h1>Source: StaticInit.h</h1>
		</TD>
		<TD valign="top" align="right" colspan="1"></TD></TR>
	</TABLE>
	<HR>
	<TABLE BORDER="0">
		
	</TABLE>
	</TD>
<TD align="right"><TABLE BORDER="0"><TR><TD><small><A HREF="index-long.html">Annotated List</small></TD></TR>
<TR><TD><small><A HREF="header-list.html">Files</small></TD></TR>
<TR><TD><small><A HREF="all-globals.html">Globals</small></TD></TR>
<TR><TD><small><A HREF="hier.html">Hierarchy</small></TD></TR>
<TR><TD><small><A HREF="index.html">Index</small></TD></TR>
</TABLE></TD></TR></TABLE>
<pre>
#ifndef StaticInit_h
#define StaticInit_h

#include &lt;memory&gt;

using namespace std;

template &lt;class Object, class Allocator = allocator&lt;Object&gt; &gt;
class StaticInit
{
public:
	/*
		This uses one function for the first call
		and then the other function for all subsequent calls.
		This avoids the overhead of having to check for 
		_item == 0 on every call to getFreeList
	*/
	static Object &amp; getStaticItem()
	{
		return whichTime();
	}
	
	Object &amp; operator () ()
	{
		return getStaticItem();
	}

private:
	
	// The instance is stored here
	static Object * _item;

	// pointer to which function to use
	static Object &amp; (*whichTime)();

	// the function called the first time
	static Object &amp; firstTime()
	{
		Allocator a;
		_item = a.allocate ( sizeof ( Object ), 0 );
		a.construct ( _item, Object() );
		
		// make sure we don't get null here
		assert(_item != 0);

		// otherwise make sure we go to the other function next time
		whichTime = nextTime;

		return *_item;
	}

	// the function called on subseqent times
	inline static Object &amp; nextTime()
	{
		return *_item;
	}
};

template &lt;class Object, class Allocator&gt;
Object * StaticInit&lt;Object, Allocator&gt;::_item = 0;

template &lt;class Object, class Allocator&gt;
Object &amp; (*StaticInit&lt;Object, Allocator&gt;::whichTime)() = StaticInit&lt;Object, Allocator&gt;::firstTime;

#endif</pre>
<HR>
	<table>
	<tr><td><small>Generated by: panic@GROOVIOUS on Wed Mar 22 18:23:58 2000, using kdoc $.</small></td></tr>
	</table>
</BODY>
</HTML>
